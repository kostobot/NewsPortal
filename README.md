# –ò—Ç–æ–≥–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ 5.4 (HW-03)

## –û—Ç—á—ë—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ —Ä–∞—Å—Å—ã–ª–æ–∫ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ NewsPortal.

### –ó–∞–¥–∞–Ω–∏–µ 1. –í –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –Ω–∞ —Ä–∞—Å—Å—ã–ª–∫—É –Ω–æ–≤—ã—Ö —Å—Ç–∞—Ç–µ–π –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.

**–û–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
–í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ö–∞–Ω–∏–∑–º –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–æ–≤–æ—Å—Ç–µ–π.
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â—É—é –µ–≥–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏ –æ—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É, –ø–æ—Å–ª–µ —á–µ–≥–æ –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –Ω–æ–≤–æ—Å—Ç—è—Ö/—Å—Ç–∞—Ç—å—è—Ö –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.

**–°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:** http://127.0.0.1:8000/posts/categories/

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
–ü—Ä–∏ –≤—ã–±–æ—Ä–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–æ–≤—Å–æ—Ç–µ–π/—Å—Ç–∞—Ç–µ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –≥–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∞ –∫–Ω–æ–ø–∫–∞ ¬´–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è¬ª.

–ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è email-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ –ø–æ–¥–ø–∏—Å–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∞.

**–ö–ª—é—á–µ–≤–æ–π –∫–æ–¥ (`views.py`):**
```python
@login_required 
def add_subscribe(request, pk):
    user = request.user
    category = get_object_or_404(Category, pk=pk)
    category.subscribers.add(request.user)
    
    text_content = f'–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π, {user.username} ! –í—ã –ø–æ–¥–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é "{category.name}". '
    f'–¢–µ–ø–µ—Ä—å –≤—ã –±—É–¥–µ—Ç–µ –æ–¥–Ω–∏–º –∏–∑ –ø–µ—Ä–≤—ã—Ö —É–∑–Ω–∞–≤–∞—Ç—å –æ –Ω–æ–≤–æ—Å—Ç—è—Ö –∏–∑ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏!'
    html_content = render_to_string('add_subscribe.html', {'username': user.username, 'category': category.name})
    
    msg = EmailMultiAlternatives(
        subject=f'News Portal: {category.name}',
        body=text_content,
        from_email='News Portal <kastetpsy@yandex.ru>',
        to=[user.email],
    )
    msg.attach_alternative(html_content, "text/html")
    msg.send()
    
    return redirect('category_posts', pk=pk)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
–ü–æ—Å–ª–µ –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –ø–∏—Å—å–º–æ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º –æ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Ä–∞—Å—Å—ã–ª–∫–∞—Ö.


### –ó–∞–¥–∞–Ω–∏–µ 2. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –∫–∞–∫—É—é-–ª–∏–±–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—é, —Ç–æ, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –≤ –Ω–µ—ë –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –Ω–æ–≤–∞—è —Å—Ç–∞—Ç—å—è, –µ—ë –∫—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω–∞ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –ø–æ—á—Ç—É, –∫–æ—Ç–æ—Ä—É—é –æ–Ω —É–∫–∞–∑–∞–ª –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. –í –ø–∏—Å—å–º–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≥–∏–ø–µ—Ä—Å—Å—ã–ª–∫–∞ –Ω–∞ —Å–∞–º—É —Å—Ç–∞—Ç—å—é, —á—Ç–æ–±—ã –æ–Ω –º–æ–≥ –ø–æ –∫–ª–∏–∫—É –ø–µ—Ä–µ–π—Ç–∏ –∏ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –µ—ë.

**–û–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–µ—Ö–∞–Ω–∏–∑–º–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ Django.
–°–∏–≥–Ω–∞–ª m2m_changed –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç–∞—Ç—å–∏ (Post) –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—é (Category).
–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ —Å–æ–±—ã—Ç–∏—è —Å–∏—Å—Ç–µ–º–∞ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∏—Å—å–º–∞ –≤—Å–µ–º –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.

**–ö–ª—é—á–µ–≤–æ–π –∫–æ–¥ (signals.py):**
```python
@receiver(m2m_changed, sender=Post.category.through)
def notify_users_new_post(sender, instance, action, **kwargs):
    if action == 'post_add':
        categories = instance.category.all()

        for category in categories:
            subscribers = category.subscribers.all()

            for user in subscribers:
                if not user.email:
                    continue

                subject = f'–ù–æ–≤—ã–π –ø–æ—Å—Ç –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {category.name}'

                preview_text = instance.text[:50] + ('...' if len(instance.text) > 50 else '')

                text_content = f'–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π, {user.username}!\n–ù–æ–≤–∞—è —Å—Ç–∞—Ç—å—è –≤ —Ç–≤–æ—ë–º –ª—é–±–∏–º–æ–º —Ä–∞–∑–¥–µ–ª–µ {instance.title}\n\n{preview_text} !'

                html_content = render_to_string('subscribe_new_post.html', {'post': instance, 'username': user.username, 'category': category.name})

                email = EmailMultiAlternatives(
                    subject=subject,
                    body=text_content,
                    from_email='kastetpsy@yandex.ru',
                    to=[user.email],
                )
                email.attach_alternative(html_content, "text/html")
                email.send()
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
–ö–∞–∂–¥—ã–π —Ä–∞–∑ –ø—Ä–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –Ω–æ–≤–æ–π —Å—Ç–∞—Ç—å–∏ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—é—Ç –ø–∏—Å—å–º–æ —Å –∫—Ä–∞—Ç–∫–∏–º –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø–æ—Å—Ç–∞ –∏ –≥–∏–ø–µ—Ä—Å—Å—ã–ª–∫–æ–π –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–∏.

### –ó–∞–¥–∞–Ω–∏–µ 3. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –∫–∞–∫—É—é-–ª–∏–±–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—é, —Ç–æ –∫–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é –µ–º—É –ø—Ä–∏—Ö–æ–¥–∏—Ç –Ω–∞ –ø–æ—á—Ç—É —Å–ø–∏—Å–æ–∫ –Ω–æ–≤—ã—Ö —Å—Ç–∞—Ç–µ–π, –ø–æ—è–≤–∏–≤—à–∏–π—Å—è –∑–∞ –Ω–µ–¥–µ–ª—é —Å –≥–∏–ø–µ—Ä—Å—Å—ã–ª–∫–æ–π –Ω–∞ –Ω–∏—Ö, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥ –ø–µ—Ä–µ–π—Ç–∏ –∏ –ø—Ä–æ—á–µ—Å—Ç—å –ª—é–±—É—é –∏–∑ —Å—Ç–∞—Ç–µ–π.

**–û–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ APScheduler, –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å Django.
–ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ –≤–æ –≤—Ç–æ—Ä–Ω–∏–∫ –≤ 14:00.
–°–∏—Å—Ç–µ–º–∞ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ—Å—Ç–æ–≤, –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞ –Ω–µ–¥–µ–ª—é, –∏ —Ä–∞—Å—Å—ã–ª–∞–µ—Ç –µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º, –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.

**–ö–ª—é—á–µ–≤–æ–π –∫–æ–¥ (runapscheduler.py):**
```python
import logging

from django.conf import settings
from apscheduler.schedulers.blocking import BlockingScheduler
from apscheduler.triggers.cron import CronTrigger
from django.core.management.base import BaseCommand
from django_apscheduler.jobstores import DjangoJobStore
from django_apscheduler.models import DjangoJobExecution

from django.core.mail import send_mail
from django.contrib.auth.models import User
from ...models import Post
from datetime import timedelta
from django.utils import timezone


logger = logging.getLogger(__name__)


def my_job():
    now = timezone.now()
    list_week_posts = Post.objects.filter(date_time__gte=now - timedelta(days=7))

    for user in User.objects.filter():
        list_category_id = list(user.categories.values_list('id', flat=True))
        list_week_posts_user = list_week_posts.filter(category__in=list_category_id)

        if list_week_posts_user:
            list_posts = ''
            for post in list_week_posts_user:
                list_posts += f'\n{post.title}\nhttp://127.0.0.1:8000/posts/{post.id}'

            send_mail(
                subject=f'News Portal: –ø–æ—Å—Ç—ã –∑–∞ –ø—Ä–æ—à–µ–¥—à—É—é –Ω–µ–¥–µ–ª—é.',
                message=f'–î–æ–±—Ä–æ–≥–æ –¥–Ω—è, {user.username}!\n–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º –í–∞–º –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –Ω–æ–≤—ã–º–∏ –ø–æ—Å—Ç–∞–º–∏, –ø–æ—è–≤–∏–≤—à–∏–º–∏—Å—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π:\n{list_posts}',
                from_email='kastetpsy@yandex.ru',
                recipient_list=[user.email],
            )


def delete_old_job_executions(max_age=604_800):
    """–£–¥–∞–ª—è–µ—Ç –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö APScheduler."""
    DjangoJobExecution.objects.delete_old_job_executions(max_age)


class Command(BaseCommand):
    help = "Runs apscheduler."

    def handle(self, *args, **options):
        scheduler = BlockingScheduler(timezone=settings.TIME_ZONE)
        scheduler.add_jobstore(DjangoJobStore(), "default")

        scheduler.add_job(
            my_job,
            trigger=CronTrigger(
                day_of_week="tue",
                hour="14",
                minute="00",
            ),
            id="my_job",
            max_instances=1,
            replace_existing=True,
        )
        logger.info("Added job 'my_job'.")

        scheduler.add_job(
            delete_old_job_executions,
            trigger=CronTrigger(
                day_of_week="tue", hour="14", minute="00"
            ),
            id="delete_old_job_executions",
            max_instances=1,
            replace_existing=True,
        )
        logger.info("Added weekly job: 'delete_old_job_executions'.")

        try:
            logger.info("Starting scheduler...")
            scheduler.start()
        except KeyboardInterrupt:
            logger.info("Stopping scheduler...")
            scheduler.shutdown()
            logger.info("Scheduler shut down successfully!")
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
–ö–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –Ω–∞ email –ø–∏—Å—å–º–æ —Å –ø–æ–¥–±–æ—Ä–∫–æ–π –Ω–æ–≤—ã—Ö —Å—Ç–∞—Ç–µ–π, –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö –≤ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏—Ö –∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö, —Å –≥–∏–ø–µ—Ä—Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –∫–∞–∂–¥—É—é –ø—É–±–ª–∏–∫–∞—Ü–∏—é.

**–ó–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞:**
python manage.py runapscheduler

### –ó–∞–¥–∞–Ω–∏–µ 4. –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø–∏—Å—å–º–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.

**–û–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
–°–∏–≥–Ω–∞–ª—ã email_confirmed (–¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏) –∏ user_signed_up (–¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏) –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç —É—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.
–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø–∏—Å—å–º–æ.

**–ö–ª—é—á–µ–≤–æ–π –∫–æ–¥ (signals.py):**
```python
def _send_welcome_email(user):
    send_mail(
        subject='–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!',
        message=f'–ü—Ä–∏–≤–µ—Ç, {user.username}!\n\n'
                f'–†–∞–¥—ã –≤–∏–¥–µ—Ç—å –≤–∞—Å –≤ –Ω–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ üéâ\n'
                f'–í—ã–±–∏—Ä–∞–π—Ç–µ –ª—é–±–∏–º—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–æ–≤–æ—Å—Ç–µ–π –∏ –ø–µ—Ä–≤—ã–º–∏ —É–∑–Ω–∞–≤–∞–π—Ç–µ –æ —Å–∞–º—ã—Ö —Å–≤–µ–∂–∏—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏—è—Ö –ø—Ä—è–º–æ –Ω–∞ –ø–æ—á—Ç–µ.\n\n'
                f'–°–ø–∞—Å–∏–±–æ, —á—Ç–æ —Å –Ω–∞–º–∏!\n–í–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ NewsPortal',
        from_email='kastetpsy@yandex.ru',
        recipient_list=[user.email],
        fail_silently=False,
    )
    
@receiver(email_confirmed)
def welcome_email_after_register(request, email_address, **kwargs):
    user = email_address.user
    _send_welcome_email(user)
    
@receiver(user_signed_up)
def welcome_after_social_signup(request, user, **kwargs):
    sociallogin = kwargs.get('sociallogin')
    if sociallogin:
        _send_welcome_email(user)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
–ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏–ª–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –ø–∏—Å—å–º–æ —Å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ–º –∏ –∫—Ä–∞—Ç–∫–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –ø–æ—Ä—Ç–∞–ª–∞.
